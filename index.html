<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –º–æ–¥–µ–ª—å Taratorkina School - v2.0</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 1800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px 12px 0 0; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .scenario-tabs { display: flex; background: #f6f8fa; padding: 10px 20px 0 20px; border-bottom: 2px solid #e1e4e8; }
        .tab { padding: 12px 24px; background: transparent; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-size: 14px; font-weight: 600; color: #586069; transition: all 0.2s; margin-right: 5px; }
        .tab:hover { background: rgba(102, 126, 234, 0.1); }
        .tab.active { background: white; color: #667eea; box-shadow: 0 -2px 4px rgba(0,0,0,0.05); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .dashboard { display: grid; grid-template-columns: 350px 1fr; gap: 0; }
        .controls { background: #fafbfc; border-right: 1px solid #e1e4e8; padding: 25px; overflow-y: auto; max-height: calc(100vh - 280px); }
        .control-group { margin-bottom: 25px; }
        .control-group h3 { font-size: 14px; font-weight: 600; color: #24292e; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #667eea; }
        .control-item { margin-bottom: 18px; }
        .control-item label { display: block; font-size: 12px; color: #586069; margin-bottom: 6px; font-weight: 500; }
        .control-item input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #e1e4e8; outline: none; -webkit-appearance: none; }
        .control-item input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #667eea; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .value-display { display: flex; justify-content: space-between; align-items: center; margin-top: 4px; }
        .current-value { font-size: 16px; font-weight: 700; color: #667eea; }
        .range-hint { font-size: 11px; color: #959da5; }
        .charts { padding: 25px; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .metric-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 18px; border-radius: 8px; border-left: 4px solid #667eea; }
        .metric-card.negative { border-left-color: #d73a49; background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%); }
        .metric-card.positive { border-left-color: #28a745; background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%); }
        .metric-label { font-size: 11px; color: #586069; margin-bottom: 6px; font-weight: 500; text-transform: uppercase; }
        .metric-value { font-size: 22px; font-weight: 700; color: #24292e; }
        .metric-change { font-size: 11px; color: #586069; margin-top: 4px; }
        .chart-container { margin-bottom: 25px; background: white; border-radius: 8px; padding: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .reset-btn { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 20px; }
        .reset-btn:hover { background: #5568d3; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3); }
        .scenario-btn { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-bottom: 8px; }
        .scenario-btn:hover { background: #218838; transform: translateY(-1px); }
        .alert { padding: 15px; border-radius: 6px; margin-bottom: 20px; font-size: 13px; line-height: 1.6; }
        .alert.danger { background: #fff5f5; border-left: 4px solid #d73a49; color: #d73a49; }
        .alert.warning { background: #fffbeb; border-left: 4px solid #f59e0b; color: #d97706; }
        .alert.success { background: #f0fff4; border-left: 4px solid #28a745; color: #22863a; }
        .comparison-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px; }
        .comparison-card { background: #f6f8fa; padding: 20px; border-radius: 8px; border: 2px solid #e1e4e8; }
        .comparison-card h4 { font-size: 16px; margin-bottom: 15px; color: #24292e; display: flex; align-items: center; }
        .comparison-card .icon { width: 32px; height: 32px; margin-right: 10px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .icon.individual { background: #667eea; }
        .icon.group { background: #28a745; }
        .stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e1e4e8; }
        .stat-row:last-child { border-bottom: none; font-weight: 700; padding-top: 12px; margin-top: 8px; border-top: 2px solid #24292e; }
        .stat-label { font-size: 13px; color: #586069; }
        .stat-value { font-size: 13px; font-weight: 600; color: #24292e; }
        .stat-value.positive { color: #28a745; }
        .stat-value.negative { color: #d73a49; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –º–æ–¥–µ–ª—å Taratorkina School</h1>
            <p>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ (–ù–∞–ª–æ–≥ 7% + –ü–æ—Å—Ç. —Ä–∞—Å—Ö–æ–¥—ã)</p>
        </div>

        <div class="scenario-tabs">
            <button class="tab active" onclick="switchTab('combined')">üìä –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å</button>
            <button class="tab" onclick="switchTab('individual')">üë§ –¢–æ–ª—å–∫–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ</button>
            <button class="tab" onclick="switchTab('group')">üë• –¢–æ–ª—å–∫–æ –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã</button>
            <button class="tab" onclick="switchTab('comparison')">‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</button>
        </div>

        <div id="tab_combined" class="tab-content active">
            <div class="dashboard">
                <div class="controls">
                    <div class="control-group">
                        <h3>üíµ –¶–µ–Ω—ã –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ (‚ÇΩ)</h3>
                        <div class="control-item">
                            <label>–ò–Ω–¥–∏–≤–∏–¥. 60 –º–∏–Ω</label>
                            <input type="range" id="price_indiv_60" min="1000" max="5000" step="100" value="2750">
                            <div class="value-display"><span class="current-value" id="val_price_indiv_60">2750 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ò–Ω–¥–∏–≤–∏–¥. 90 –º–∏–Ω</label>
                            <input type="range" id="price_indiv_90" min="1500" max="6000" step="100" value="4000">
                            <div class="value-display"><span class="current-value" id="val_price_indiv_90">4000 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ú–∏–Ω–∏-–≥—Ä—É–ø–ø–∞ 60 –º–∏–Ω/—á–µ–ª</label>
                            <input type="range" id="price_group_60" min="1000" max="3000" step="100" value="2750">
                            <div class="value-display"><span class="current-value" id="val_price_group_60">2750 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ú–∏–Ω–∏-–≥—Ä—É–ø–ø–∞ 90 –º–∏–Ω/—á–µ–ª</label>
                            <input type="range" id="price_group_90" min="2000" max="4000" step="100" value="4000">
                            <div class="value-display"><span class="current-value" id="val_price_group_90">4000 ‚ÇΩ</span></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>üë®‚Äçüè´ –°—Ç–∞–≤–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π (‚ÇΩ)</h3>
                        <div class="control-item">
                            <label>–ò–Ω–¥–∏–≤–∏–¥. 60 –º–∏–Ω</label>
                            <input type="range" id="teacher_indiv_60" min="1500" max="4000" step="100" value="3000">
                            <div class="value-display"><span class="current-value" id="val_teacher_indiv_60">3000 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ò–Ω–¥–∏–≤–∏–¥. 90 –º–∏–Ω</label>
                            <input type="range" id="teacher_indiv_90" min="2000" max="5000" step="100" value="4500">
                            <div class="value-display"><span class="current-value" id="val_teacher_indiv_90">4500 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ì—Ä—É–ø–ø–∞ 60 –º–∏–Ω (–æ–±—â–∞—è)</label>
                            <input type="range" id="teacher_group_60" min="2500" max="6000" step="100" value="4500">
                            <div class="value-display"><span class="current-value" id="val_teacher_group_60">4500 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ì—Ä—É–ø–ø–∞ 90 –º–∏–Ω (–æ–±—â–∞—è)</label>
                            <input type="range" id="teacher_group_90" min="2500" max="8000" step="100" value="6000">
                            <div class="value-display"><span class="current-value" id="val_teacher_group_90">6000 ‚ÇΩ</span></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>üí∏ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ</h3>
                        <div class="control-item">
                            <label>CPL - —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–∏–¥–∞ (‚ÇΩ)</label>
                            <input type="range" id="cpl" min="300" max="1000" step="50" value="500">
                            <div class="value-display"><span class="current-value" id="val_cpl">500 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ª–∏–¥‚Üí–∫–ª–∏–µ–Ω—Ç (%)</label>
                            <input type="range" id="conversion" min="5" max="25" step="1" value="12">
                            <div class="value-display"><span class="current-value" id="val_conversion">12%</span></div>
                        </div>
                        <div class="control-item">
                            <label style="color: #d73a49; font-weight: 600;">üí∞ CAC (–∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç)</label>
                            <div class="value-display"><span class="current-value" id="cac_display" style="font-size: 20px;">4167 ‚ÇΩ</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ö–æ–º–∏—Å—Å–∏—è –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ (%)</label>
                            <input type="range" id="agency_commission" min="0" max="30" step="1" value="20">
                            <div class="value-display"><span class="current-value" id="val_agency_commission">20%</span></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>‚öôÔ∏è –î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                        <div class="control-item">
                            <label>–†–∞–∑–º–µ—Ä –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã (—á–µ–ª)</label>
                            <input type="range" id="group_size" min="2" max="6" step="1" value="3">
                            <div class="value-display"><span class="current-value" id="val_group_size">3 —á–µ–ª</span></div>
                        </div>
                        <div class="control-item">
                            <label>–í—Å–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤/–º–µ—Å</label>
                            <input type="range" id="total_students" min="20" max="150" step="5" value="50">
                            <div class="value-display"><span class="current-value" id="val_total_students">50</span></div>
                        </div>
                         <div class="control-item">
                            <label>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (‚ÇΩ)</label>
                            <input type="range" id="fixed_costs" min="0" max="100000" step="5000" value="40000">
                            <div class="value-display">
                                <span class="current-value" id="val_fixed_costs">40 000 ‚ÇΩ</span>
                                <span class="range-hint">–ê—Ä–µ–Ω–¥–∞, –ü–û –∏ –¥—Ä.</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>üë• –ú–∏–∫—Å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ (%)</h3>
                        <div class="control-item">
                            <label>–ò–Ω–¥–∏–≤–∏–¥. 60 –º–∏–Ω</label>
                            <input type="range" id="pct_indiv_60" min="0" max="50" step="5" value="15">
                            <div class="value-display"><span class="current-value" id="val_pct_indiv_60">15%</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ò–Ω–¥–∏–≤–∏–¥. 90 –º–∏–Ω</label>
                            <input type="range" id="pct_indiv_90" min="0" max="50" step="5" value="15">
                            <div class="value-display"><span class="current-value" id="val_pct_indiv_90">15%</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ì—Ä—É–ø–ø–∞ 60 –º–∏–Ω</label>
                            <input type="range" id="pct_group_60" min="0" max="70" step="5" value="40">
                            <div class="value-display"><span class="current-value" id="val_pct_group_60">40%</span></div>
                        </div>
                        <div class="control-item">
                            <label>–ì—Ä—É–ø–ø–∞ 90 –º–∏–Ω</label>
                            <input type="range" id="pct_group_90" min="0" max="70" step="5" value="30">
                            <div class="value-display"><span class="current-value" id="val_pct_group_90">30%</span></div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>üéØ –ë—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h3>
                        <button class="scenario-btn" onclick="applyScenario('optimal')">üü¢ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π (—Ü–µ–Ω–∞ +27%, —Å—Ç–∞–≤–∫–∞ -17%)</button>
                        <button class="scenario-btn" onclick="applyScenario('no_agency')">üîµ –ë–µ–∑ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ (–∫–æ–º–∏—Å—Å–∏—è 0%)</button>
                        <button class="scenario-btn" onclick="applyScenario('premium')">üíé –ü—Ä–µ–º–∏—É–º (—Ü–µ–Ω–∞ +45%, –∫–∞—á–µ—Å—Ç–≤–æ)</button>
                        <button class="scenario-btn" onclick="applyScenario('budget')">üí∞ –ë—é–¥–∂–µ—Ç–Ω—ã–π (—Å—Ç–∞–≤–∫–∞ -33%)</button>
                    </div>
                    <button class="reset-btn" onclick="resetToDefaults()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ –±–∞–∑–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º</button>
                </div>

                <div class="charts">
                    <div id="alert_container_combined"></div>
                    <div class="metrics">
                        <div class="metric-card" id="metric_revenue">
                            <div class="metric-label">–í—ã—Ä—É—á–∫–∞/–º–µ—Å</div>
                            <div class="metric-value" id="metric_revenue_val">-</div>
                        </div>
                        <div class="metric-card" id="metric_profit">
                            <div class="metric-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                            <div class="metric-value" id="metric_profit_val">-</div>
                            <div class="metric-change" id="metric_profit_pct">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">CAC</div>
                            <div class="metric-value" id="metric_cac_val">-</div>
                            <div class="metric-change" id="metric_cac_detail">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">–¢–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</div>
                            <div class="metric-value" id="metric_break_even">-</div>
                        </div>
                    </div>
                    <div class="chart-container"><div id="chart_margin"></div></div>
                    <div class="chart-container"><div id="chart_pnl"></div></div>
                    <div class="chart-container"><div id="chart_structure"></div></div>
                </div>
            </div>
        </div>

        <div id="tab_individual" class="tab-content">
            <div class="dashboard">
                <div class="controls">
                    <div class="alert success">
                        <strong>üë§ –ú–æ–¥–µ–ª—å "–¢–æ–ª—å–∫–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ"</strong><br>
                        100% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏—è—Ö.
                    </div>
                    <div class="control-item">
                        <label>–î–æ–ª—è –∑–∞–Ω—è—Ç–∏–π 60 –º–∏–Ω (%)</label>
                        <input type="range" id="indiv_mix_60" min="0" max="100" step="10" value="50">
                        <div class="value-display"><span class="current-value" id="val_indiv_mix_60">50%</span></div>
                    </div>
                </div>
                <div class="charts">
                    <div id="alert_container_individual"></div>
                    <div class="metrics">
                        <div class="metric-card"><div class="metric-label">–í—ã—Ä—É—á–∫–∞/–º–µ—Å</div><div class="metric-value" id="metric_revenue_indiv">-</div></div>
                        <div class="metric-card" id="metric_profit_indiv_card"><div class="metric-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div><div class="metric-value" id="metric_profit_indiv">-</div><div class="metric-change" id="metric_profit_pct_indiv">-</div></div>
                        <div class="metric-card"><div class="metric-label">–°—Ä–µ–¥–Ω—è—è –º–∞—Ä–∂–∞/—Å—Ç—É–¥–µ–Ω—Ç</div><div class="metric-value" id="metric_avg_margin_indiv">-</div></div>
                        <div class="metric-card"><div class="metric-label">–¢–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</div><div class="metric-value" id="metric_break_even_indiv">-</div></div>
                    </div>
                    <div class="chart-container"><div id="chart_indiv_margin"></div></div>
                    <div class="chart-container"><div id="chart_indiv_pnl"></div></div>
                </div>
            </div>
        </div>

        <div id="tab_group" class="tab-content">
            <div class="dashboard">
                <div class="controls">
                    <div class="alert success">
                        <strong>üë• –ú–æ–¥–µ–ª—å "–¢–æ–ª—å–∫–æ –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã"</strong><br>
                        100% —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –º–∏–Ω–∏-–≥—Ä—É–ø–ø–∞—Ö.
                    </div>
                    <div class="control-item">
                        <label>–î–æ–ª—è –∑–∞–Ω—è—Ç–∏–π 60 –º–∏–Ω (%)</label>
                        <input type="range" id="group_mix_60" min="0" max="100" step="10" value="50">
                        <div class="value-display"><span class="current-value" id="val_group_mix_60">50%</span></div>
                    </div>
                </div>
                <div class="charts">
                    <div id="alert_container_group"></div>
                    <div class="metrics">
                        <div class="metric-card"><div class="metric-label">–í—ã—Ä—É—á–∫–∞/–º–µ—Å</div><div class="metric-value" id="metric_revenue_group">-</div></div>
                        <div class="metric-card" id="metric_profit_group_card"><div class="metric-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div><div class="metric-value" id="metric_profit_group">-</div><div class="metric-change" id="metric_profit_pct_group">-</div></div>
                        <div class="metric-card"><div class="metric-label">–°—Ä–µ–¥–Ω—è—è –º–∞—Ä–∂–∞/—Å—Ç—É–¥–µ–Ω—Ç</div><div class="metric-value" id="metric_avg_margin_group">-</div></div>
                        <div class="metric-card"><div class="metric-label">–¢–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</div><div class="metric-value" id="metric_break_even_group">-</div></div>
                    </div>
                    <div class="chart-container"><div id="chart_group_margin"></div></div>
                    <div class="chart-container"><div id="chart_group_pnl"></div></div>
                </div>
            </div>
        </div>

        <div id="tab_comparison" class="tab-content">
            <div class="charts" style="padding: 30px;">
                <h2 style="margin-bottom: 20px; color: #24292e;">‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</h2>
                <div class="comparison-grid">
                    <div class="comparison-card">
                        <h4><div class="icon individual">üë§</div>–¢–æ–ª—å–∫–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ</h4>
                        <div id="comparison_individual_stats"></div>
                    </div>
                    <div class="comparison-card">
                        <h4><div class="icon group">üë•</div>–¢–æ–ª—å–∫–æ –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã</h4>
                        <div id="comparison_group_stats"></div>
                    </div>
                </div>
                <div class="chart-container"><div id="chart_comparison"></div></div>
                <div class="chart-container"><div id="chart_comparison_revenue"></div></div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'combined';

        const defaults = {
            price_indiv_60: 2750,
            price_indiv_90: 4000,
            price_group_60: 2750,
            price_group_90: 4000,
            teacher_indiv_60: 3000,
            teacher_indiv_90: 4500,
            teacher_group_60: 4500,
            teacher_group_90: 6000,
            group_size: 3,
            agency_commission: 20,
            cpl: 500,
            conversion: 12,
            avg_packages: 2.5,
            total_students: 50,
            fixed_costs: 40000, // New default
            pct_indiv_60: 15,
            pct_indiv_90: 15,
            pct_group_60: 40,
            pct_group_90: 30,
            indiv_mix_60: 50,
            group_mix_60: 50
        };

        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab_' + tabName).classList.add('active');
            event.target.classList.add('active');
            calculate();
        }

        function initControls() {
            Object.keys(defaults).forEach(key => {
                const input = document.getElementById(key);
                if (input) {
                    input.addEventListener('input', function() {
                        updateValueDisplay(key, this.value);
                        calculate();
                    });
                    updateValueDisplay(key, input.value);
                }
            });
            calculate();
        }

        function updateValueDisplay(key, value) {
            const display = document.getElementById('val_' + key);
            if (!display) return;
            if (key.includes('price') || key.includes('teacher') || key === 'cpl' || key === 'fixed_costs') {
                display.textContent = Math.round(value).toLocaleString('ru-RU') + ' ‚ÇΩ';
            } else if (key.includes('pct') || key.includes('mix') || key === 'agency_commission' || key === 'conversion') {
                display.textContent = value + '%';
            } else if (key === 'group_size') {
                display.textContent = value + ' —á–µ–ª';
            } else {
                display.textContent = value;
            }
        }

        function getParams() {
            const getVal = (id) => parseFloat(document.getElementById(id).value);
            return {
                price_indiv_60: getVal('price_indiv_60'),
                price_indiv_90: getVal('price_indiv_90'),
                price_group_60: getVal('price_group_60'),
                price_group_90: getVal('price_group_90'),
                teacher_indiv_60: getVal('teacher_indiv_60'),
                teacher_indiv_90: getVal('teacher_indiv_90'),
                teacher_group_60: getVal('teacher_group_60'),
                teacher_group_90: getVal('teacher_group_90'),
                group_size: getVal('group_size'),
                agency_commission: getVal('agency_commission') / 100,
                cpl: getVal('cpl'),
                conversion: getVal('conversion') / 100,
                avg_packages: 2.5, // Fixed assumption or add slider if needed
                total_students: getVal('total_students'),
                fixed_costs: getVal('fixed_costs'),
                pct_indiv_60: getVal('pct_indiv_60') / 100,
                pct_indiv_90: getVal('pct_indiv_90') / 100,
                pct_group_60: getVal('pct_group_60') / 100,
                pct_group_90: getVal('pct_group_90') / 100,
                indiv_mix_60: getVal('indiv_mix_60') / 100,
                group_mix_60: getVal('group_mix_60') / 100
            };
        }

        function calculate() {
            if (currentTab === 'combined') calculateCombined();
            else if (currentTab === 'individual') calculateIndividual();
            else if (currentTab === 'group') calculateGroup();
            else if (currentTab === 'comparison') calculateComparison();
        }

        function calculateCombined() {
            const p = getParams();
            const cac = p.cpl / p.conversion;
            document.getElementById('cac_display').textContent = Math.round(cac).toLocaleString('ru-RU') + ' ‚ÇΩ';

            // UPDATED: Tax is 7%
            const tax_rate = 0.07;

            const formats = [
                { name: '–ò–Ω–¥–∏–≤–∏–¥. 60 –º–∏–Ω', price: p.price_indiv_60, teacher: p.teacher_indiv_60, group_divisor: 1 },
                { name: '–ò–Ω–¥–∏–≤–∏–¥. 90 –º–∏–Ω', price: p.price_indiv_90, teacher: p.teacher_indiv_90, group_divisor: 1 },
                { name: '–ì—Ä—É–ø–ø–∞ 60 –º–∏–Ω', price: p.price_group_60, teacher: p.teacher_group_60, group_divisor: p.group_size },
                { name: '–ì—Ä—É–ø–ø–∞ 90 –º–∏–Ω', price: p.price_group_90, teacher: p.teacher_group_90, group_divisor: p.group_size }
            ];

            // Unit Economics (per 8 lessons package)
            const ue = formats.map(f => {
                const ltv = f.price * 8; // Revenue per month (8 lessons)
                const teacher_cost = (f.teacher * 8) / f.group_divisor;
                const tax = ltv * tax_rate;
                const agency = ltv * p.agency_commission;
                // Contribution Margin per student per month
                const margin = ltv - teacher_cost - tax - cac - agency;

                return {
                    name: f.name,
                    ltv: ltv,
                    teacher: teacher_cost,
                    tax: tax,
                    cac: cac,
                    agency: agency,
                    margin: margin
                };
            });

            const n_i60 = Math.round(p.total_students * p.pct_indiv_60);
            const n_i90 = Math.round(p.total_students * p.pct_indiv_90);
            const n_g60 = Math.round(p.total_students * p.pct_group_60);
            const n_g90 = Math.round(p.total_students * p.pct_group_90);

            const revenue = n_i60 * ue[0].ltv + n_i90 * ue[1].ltv + n_g60 * ue[2].ltv + n_g90 * ue[3].ltv;
            const teacher_total = n_i60 * ue[0].teacher + n_i90 * ue[1].teacher + n_g60 * ue[2].teacher + n_g90 * ue[3].teacher;
            const tax_total = revenue * tax_rate;
            const cac_total = p.total_students * cac;
            const agency_total = revenue * p.agency_commission;
            
            // Contribution Profit (before fixed costs)
            const contribution_profit = revenue - teacher_total - tax_total - cac_total - agency_total;
            
            // Net Profit (after fixed costs)
            const profit = contribution_profit - p.fixed_costs;
            const margin_pct = (profit / revenue) * 100;

            document.getElementById('metric_revenue_val').textContent = Math.round(revenue).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_profit_val').textContent = (profit >= 0 ? '+' : '') + Math.round(profit).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_profit_pct').textContent = '–ú–∞—Ä–∂–∞: ' + (profit >= 0 ? '+' : '') + margin_pct.toFixed(1) + '%';
            document.getElementById('metric_profit').className = 'metric-card ' + (profit >= 0 ? 'positive' : 'negative');
            document.getElementById('metric_cac_val').textContent = Math.round(cac).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_cac_detail').textContent = 'CPL ' + p.cpl + '‚ÇΩ / CR ' + (p.conversion * 100).toFixed(0) + '%';

            // Break-even calculation
            const avg_contribution_per_student = contribution_profit / p.total_students;
            // How many students to cover Fixed Costs?
            const break_even = avg_contribution_per_student > 0 ? Math.ceil(p.fixed_costs / avg_contribution_per_student) : '–Ω/–¥';
            
            document.getElementById('metric_break_even').textContent = (typeof break_even === 'number' && break_even < 1000 ? break_even : '‚àû') + ' —Å—Ç—É–¥/–º–µ—Å';

            updateAlert('alert_container_combined', profit, margin_pct, ue);
            updateCharts(ue, revenue, teacher_total, tax_total, cac_total, agency_total, p.fixed_costs, profit);
        }

        function calculateIndividual() {
            const p = getParams();
            const cac = p.cpl / p.conversion;
            const tax_rate = 0.07;
            const mix_60 = p.indiv_mix_60;
            const n_60 = Math.round(p.total_students * mix_60);
            const n_90 = p.total_students - n_60;

            // Unit calc
            const calcUnit = (price, teacher) => {
                const ltv = price * 8;
                const t_cost = teacher * 8;
                const tax = ltv * tax_rate;
                const agency = ltv * p.agency_commission;
                const margin = ltv - t_cost - tax - cac - agency;
                return { ltv, t_cost, tax, agency, margin };
            };

            const u60 = calcUnit(p.price_indiv_60, p.teacher_indiv_60);
            const u90 = calcUnit(p.price_indiv_90, p.teacher_indiv_90);

            const revenue = n_60 * u60.ltv + n_90 * u90.ltv;
            const teacher_total = n_60 * u60.t_cost + n_90 * u90.t_cost;
            const tax_total = revenue * tax_rate;
            const cac_total = p.total_students * cac;
            const agency_total = revenue * p.agency_commission;
            
            const contribution_profit = revenue - teacher_total - tax_total - cac_total - agency_total;
            const profit = contribution_profit - p.fixed_costs;
            const margin_pct = (profit / revenue) * 100;

            document.getElementById('metric_revenue_indiv').textContent = Math.round(revenue).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_profit_indiv').textContent = (profit >= 0 ? '+' : '') + Math.round(profit).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_profit_pct_indiv').textContent = '–ú–∞—Ä–∂–∞: ' + (profit >= 0 ? '+' : '') + margin_pct.toFixed(1) + '%';
            document.getElementById('metric_profit_indiv_card').className = 'metric-card ' + (profit >= 0 ? 'positive' : 'negative');
            
            const avg_margin = contribution_profit / p.total_students;
            document.getElementById('metric_avg_margin_indiv').textContent = (avg_margin >= 0 ? '+' : '') + Math.round(avg_margin).toLocaleString('ru-RU') + ' ‚ÇΩ';
            
            const break_even = avg_margin > 0 ? Math.ceil(p.fixed_costs / avg_margin) : '–Ω/–¥';
            document.getElementById('metric_break_even_indiv').textContent = break_even + ' —Å—Ç—É–¥/–º–µ—Å';

            const ue = [{ name: '–ò–Ω–¥–∏–≤–∏–¥. 60 –º–∏–Ω', margin: u60.margin }, { name: '–ò–Ω–¥–∏–≤–∏–¥. 90 –º–∏–Ω', margin: u90.margin }];
            updateAlert('alert_container_individual', profit, margin_pct, ue);

            drawSimpleCharts('chart_indiv_margin', 'chart_indiv_pnl', ue, revenue, teacher_total, tax_total, cac_total, agency_total, p.fixed_costs, profit, '–¢–æ–ª—å–∫–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ');
        }

        function calculateGroup() {
            const p = getParams();
            const cac = p.cpl / p.conversion;
            const tax_rate = 0.07;
            const mix_60 = p.group_mix_60;
            const n_60 = Math.round(p.total_students * mix_60);
            const n_90 = p.total_students - n_60;

            const calcUnit = (price, teacher) => {
                const ltv = price * 8;
                const t_cost = (teacher * 8) / p.group_size;
                const tax = ltv * tax_rate;
                const agency = ltv * p.agency_commission;
                const margin = ltv - t_cost - tax - cac - agency;
                return { ltv, t_cost, tax, agency, margin };
            };

            const u60 = calcUnit(p.price_group_60, p.teacher_group_60);
            const u90 = calcUnit(p.price_group_90, p.teacher_group_90);

            const revenue = n_60 * u60.ltv + n_90 * u90.ltv;
            const teacher_total = n_60 * u60.t_cost + n_90 * u90.t_cost;
            const tax_total = revenue * tax_rate;
            const cac_total = p.total_students * cac;
            const agency_total = revenue * p.agency_commission;

            const contribution_profit = revenue - teacher_total - tax_total - cac_total - agency_total;
            const profit = contribution_profit - p.fixed_costs;
            const margin_pct = (profit / revenue) * 100;

            document.getElementById('metric_revenue_group').textContent = Math.round(revenue).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_profit_group').textContent = (profit >= 0 ? '+' : '') + Math.round(profit).toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('metric_profit_pct_group').textContent = '–ú–∞—Ä–∂–∞: ' + (profit >= 0 ? '+' : '') + margin_pct.toFixed(1) + '%';
            document.getElementById('metric_profit_group_card').className = 'metric-card ' + (profit >= 0 ? 'positive' : 'negative');
            
            const avg_margin = contribution_profit / p.total_students;
            document.getElementById('metric_avg_margin_group').textContent = (avg_margin >= 0 ? '+' : '') + Math.round(avg_margin).toLocaleString('ru-RU') + ' ‚ÇΩ';
            
            const break_even = avg_margin > 0 ? Math.ceil(p.fixed_costs / avg_margin) : '–Ω/–¥';
            document.getElementById('metric_break_even_group').textContent = break_even + ' —Å—Ç—É–¥/–º–µ—Å';

            const ue = [{ name: '–ì—Ä—É–ø–ø–∞ 60 –º–∏–Ω', margin: u60.margin }, { name: '–ì—Ä—É–ø–ø–∞ 90 –º–∏–Ω', margin: u90.margin }];
            updateAlert('alert_container_group', profit, margin_pct, ue);
            
            drawSimpleCharts('chart_group_margin', 'chart_group_pnl', ue, revenue, teacher_total, tax_total, cac_total, agency_total, p.fixed_costs, profit, '–¢–æ–ª—å–∫–æ –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã');
        }

        function calculateComparison() {
            const p = getParams();
            const cac = p.cpl / p.conversion;
            const tax_rate = 0.07;

            // Common calc function
            const getScenarioStats = (isGroup) => {
                const mix_60 = isGroup ? p.group_mix_60 : p.indiv_mix_60;
                const price_60 = isGroup ? p.price_group_60 : p.price_indiv_60;
                const price_90 = isGroup ? p.price_group_90 : p.price_indiv_90;
                const teach_60 = isGroup ? p.teacher_group_60 : p.teacher_indiv_60;
                const teach_90 = isGroup ? p.teacher_group_90 : p.teacher_indiv_90;
                const divisor = isGroup ? p.group_size : 1;

                const revenue = p.total_students * 8 * (mix_60 * price_60 + (1-mix_60) * price_90);
                const teacher = p.total_students * 8 * (mix_60 * teach_60 + (1-mix_60) * teach_90) / divisor;
                const tax = revenue * tax_rate;
                const agency = revenue * p.agency_commission;
                const cac_total = p.total_students * cac;
                
                const contribution = revenue - teacher - tax - agency - cac_total;
                const profit = contribution - p.fixed_costs;
                const margin = (profit / revenue) * 100;
                
                return { revenue, teacher, tax, agency, cac_total, profit, margin };
            };

            const sIndiv = getScenarioStats(false);
            const sGroup = getScenarioStats(true);

            const renderStats = (id, data) => {
                document.getElementById(id).innerHTML = `
                    <div class="stat-row"><span class="stat-label">–í—ã—Ä—É—á–∫–∞/–º–µ—Å</span><span class="stat-value">${Math.round(data.revenue).toLocaleString('ru-RU')} ‚ÇΩ</span></div>
                    <div class="stat-row"><span class="stat-label">–†–∞—Å—Ö–æ–¥ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</span><span class="stat-value">‚àí${Math.round(data.teacher).toLocaleString('ru-RU')} ‚ÇΩ</span></div>
                    <div class="stat-row"><span class="stat-label">–ù–∞–ª–æ–≥–∏ (7%)</span><span class="stat-value">‚àí${Math.round(data.tax).toLocaleString('ru-RU')} ‚ÇΩ</span></div>
                    <div class="stat-row"><span class="stat-label">–ü–æ—Å—Ç. —Ä–∞—Å—Ö–æ–¥—ã</span><span class="stat-value">‚àí${Math.round(p.fixed_costs).toLocaleString('ru-RU')} ‚ÇΩ</span></div>
                    <div class="stat-row"><span class="stat-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</span><span class="stat-value ${data.profit >= 0 ? 'positive' : 'negative'}">${(data.profit >= 0 ? '+' : '')}${Math.round(data.profit).toLocaleString('ru-RU')} ‚ÇΩ</span></div>
                    <div class="stat-row"><span class="stat-label">–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å</span><span class="stat-value ${data.margin >= 0 ? 'positive' : 'negative'}">${data.margin.toFixed(1)}%</span></div>
                `;
            };

            renderStats('comparison_individual_stats', sIndiv);
            renderStats('comparison_group_stats', sGroup);

            // Chart Comparison
             Plotly.newPlot('chart_comparison', [{
                x: ['–¢–æ–ª—å–∫–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ', '–¢–æ–ª—å–∫–æ –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã'],
                y: [sIndiv.profit, sGroup.profit],
                type: 'bar',
                text: [Math.round(sIndiv.profit) + ' ‚ÇΩ', Math.round(sGroup.profit) + ' ‚ÇΩ'],
                textposition: 'outside',
                marker: { color: [sIndiv.profit >= 0 ? '#667eea' : '#d73a49', sGroup.profit >= 0 ? '#28a745' : '#d73a49'] }
            }], { title: '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å (–ø–æ—Å–ª–µ –ø–æ—Å—Ç. —Ä–∞—Å—Ö–æ–¥–æ–≤)', yaxis: {title: '–†—É–±–ª–∏'}, height: 400 });

             Plotly.newPlot('chart_comparison_revenue', [
                { x: ['–ò–Ω–¥–∏–≤.', '–ì—Ä—É–ø–ø—ã'], y: [sIndiv.revenue, sGroup.revenue], name: '–í—ã—Ä—É—á–∫–∞', type: 'bar', marker: {color: '#667eea'} },
                { x: ['–ò–Ω–¥–∏–≤.', '–ì—Ä—É–ø–ø—ã'], y: [sIndiv.revenue - sIndiv.profit, sGroup.revenue - sGroup.profit], name: '–í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã', type: 'bar', marker: {color: '#d73a49'} }
             ], { title: '–í—ã—Ä—É—á–∫–∞ vs –†–∞—Å—Ö–æ–¥—ã', barmode: 'group', height: 400 });
        }

        function updateAlert(id, profit, margin, ue) {
            const el = document.getElementById(id);
            if (profit < 0) el.innerHTML = `<div class="alert danger"><strong>üî¥ –£–±—ã—Ç–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å!</strong> –ß–∏—Å—Ç—ã–π —É–±—ã—Ç–æ–∫ ${Math.round(Math.abs(profit))} ‚ÇΩ.</div>`;
            else if (margin < 15) el.innerHTML = `<div class="alert warning"><strong>üü° –ù–∏–∑–∫–∞—è –º–∞—Ä–∂–∞</strong> (${margin.toFixed(1)}%). –†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ.</div>`;
            else el.innerHTML = `<div class="alert success"><strong>üü¢ –ü—Ä–∏–±—ã–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å</strong>. –ú–∞—Ä–∂–∞ ${margin.toFixed(1)}%.</div>`;
        }

        function updateCharts(ue, rev, teach, tax, cac, ag, fixed, prof) {
            // Margin bar
            Plotly.newPlot('chart_margin', [{
                x: ue.map(f => f.name), y: ue.map(f => f.margin), type: 'bar',
                marker: { color: ue.map(f => f.margin >= 0 ? '#28a745' : '#d73a49') }
            }], { title: 'Contribution Margin –Ω–∞ 1 —Å—Ç—É–¥–µ–Ω—Ç–∞', height: 350 });

            // P&L Waterfall
            Plotly.newPlot('chart_pnl', [{
                x: ['–í—ã—Ä—É—á–∫–∞', '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏', '–ù–∞–ª–æ–≥ (7%)', 'CAC', '–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ', '–ü–æ—Å—Ç. —Ä–∞—Å—Ö–æ–¥—ã', '–ü—Ä–∏–±—ã–ª—å'],
                y: [rev, -teach, -tax, -cac, -ag, -fixed, prof],
                type: 'bar',
                text: [Math.round(rev), Math.round(-teach), Math.round(-tax), Math.round(-cac), Math.round(-ag), Math.round(-fixed), Math.round(prof)],
                textposition: 'outside',
                marker: { color: ['#28a745', '#d73a49', '#f59e0b', '#d73a49', '#d73a49', '#667eea', prof>=0?'#28a745':'#d73a49'] }
            }], { title: 'P&L (–û—Ç—á–µ—Ç –æ –ø—Ä–∏–±—ã–ª—è—Ö –∏ —É–±—ã—Ç–∫–∞—Ö)', height: 350 });

            // Structure
            Plotly.newPlot('chart_structure', [
                { name: 'LTV', x: ue.map(f=>f.name), y: ue.map(f=>f.ltv), type: 'bar', marker:{color:'#28a745'}},
                { name: '–£—á–∏—Ç–µ–ª—å', x: ue.map(f=>f.name), y: ue.map(f=>-f.teacher), type: 'bar', marker:{color:'#667eea'}},
                { name: '–ù–∞–ª–æ–≥', x: ue.map(f=>f.name), y: ue.map(f=>-f.tax), type: 'bar', marker:{color:'#f59e0b'}},
                { name: 'CAC', x: ue.map(f=>f.name), y: ue.map(f=>-f.cac), type: 'bar', marker:{color:'#ec4899'}},
                { name: '–ê–≥–µ–Ω—Ç', x: ue.map(f=>f.name), y: ue.map(f=>-f.agency), type: 'bar', marker:{color:'#d73a49'}}
            ], { title: '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Unit-—ç–∫–æ–Ω–æ–º–∏–∫–∏', barmode: 'relative', height: 350 });
        }

        function drawSimpleCharts(idMarg, idPnl, ue, rev, teach, tax, cac, ag, fixed, prof, title) {
             Plotly.newPlot(idMarg, [{
                x: ue.map(f => f.name), y: ue.map(f => f.margin), type: 'bar',
                marker: { color: ue.map(f => f.margin >= 0 ? '#28a745' : '#d73a49') }
            }], { title: 'Contribution Margin –Ω–∞ 1 —Å—Ç—É–¥–µ–Ω—Ç–∞', height: 350 });

             Plotly.newPlot(idPnl, [{
                x: ['–í—ã—Ä—É—á–∫–∞', '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏', '–ù–∞–ª–æ–≥', 'CAC', '–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ', 'Fixed', '–ü—Ä–∏–±—ã–ª—å'],
                y: [rev, -teach, -tax, -cac, -ag, -fixed, prof],
                type: 'bar',
                marker: { color: ['#28a745', '#d73a49', '#f59e0b', '#d73a49', '#d73a49', '#667eea', prof>=0?'#28a745':'#d73a49'] }
            }], { title: 'P&L: ' + title, height: 350 });
        }

        function applyScenario(s) {
            const set = (k, v) => { document.getElementById(k).value = v; updateValueDisplay(k, v); };
            if(s==='optimal') { set('price_indiv_60',3500); set('price_indiv_90',5000); set('teacher_indiv_60',2500); set('agency_commission',10); }
            if(s==='no_agency') set('agency_commission', 0);
            if(s==='premium') { set('price_indiv_60',4000); set('price_indiv_90',5500); set('price_group_60',2500); }
            if(s==='budget') { set('teacher_indiv_60',2000); set('teacher_indiv_90',3000); }
            calculate();
        }

        function resetToDefaults() {
            Object.keys(defaults).forEach(key => {
                const el = document.getElementById(key);
                if(el) { el.value = defaults[key]; updateValueDisplay(key, defaults[key]); }
            });
            calculate();
        }

        window.addEventListener('load', initControls);
    </script>
</body>
</html>
